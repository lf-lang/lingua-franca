target C {
  timeout: 1 s
}

reactor Src {
  timer t(0)
  output out: int

  reaction(t) -> out {=
    lf_sleep(MSEC(100));
    lf_set(out, lf_time_logical_elapsed());
  =}
}

reactor Sink {
  input in: int
  state check: bool = false
  timer t(1 msec)

  reaction(t) {=
    self->check = true;
    lf_print("Timer triggered");
  =}

  reaction(in) {=
    if (!self->check) {
        lf_print_error_and_exit("Sink was stalled even with physical connection");
    }
    lf_print("Got %d", in->value);
  =}
}

main reactor {
  @enclave
  src = new Src()

  sink = new Sink()

  src.out ~> sink.in
}
