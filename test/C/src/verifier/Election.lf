target C

reactor Node(id: int = 0) {
  input inp: int
  output out: int
  state elected: int = 0

  reaction(startup) -> out {=
    lf_set(out, self->id);
  =}

  reaction(inp) -> out {=
    if (inp->value > self->id) {
        lf_set(out, inp->value);
    } else if (inp->value == self->id) {
        self->elected = 1;
    }
  =}
}

// This property being checked does not hold. A valid property is F[0, 30 msec]((Election2_i0_elected + Election2_i1_elected + Election2_i2_elected) == 1)
@property(
    name = "exactly_one_elected",
    tactic = "bmc",
    spec = "F[0, 20 msec]((Election2.i0.elected + Election2.i1.elected + Election2.i2.elected) == 1)",
    expect = false)
main reactor {
  i0 = new Node(id=0)
  i1 = new Node(id=1)
  i2 = new Node(id=2)
  i0.out -> i1.inp after 10 msec
  i1.out -> i2.inp after 10 msec
  i2.out -> i0.inp after 10 msec
}
