<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>lingua-franca: Contributing to Lingua Franca</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">lingua-franca<span id="projectnumber">&#160;0.10.1</span>
   </div>
   <div id="projectbrief">Lingua Franca code generator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2Users_2runner_2work_2lingua-franca_2lingua-franca_2docs_2markdown_22__contributing.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Contributing to Lingua Franca </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<dl class="section important"><dt>Important</dt><dd>This document contains guidelines specific to this repository. Please also read the general <a href="https://github.com/lf-lang/.github/blob/main/CONTRIBUTING.md">contributing guidelines</a> of the lf-lang organization.</dd></dl>
<p>This repository hosts the source code for the Lingua Franca compiler, which is written in Java and Kotlin. We welcome contributions from the community and provide these guidelines in order to make contributing a smooth, efficient, and fun process.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Contributing code</h1>
<p>You can work on the Lingua Franca code base in your favorite editor and build <a href="https://www.lf-lang.org/docs/developer/downloading-and-building#building-the-command-line-tools">using Gradle</a>. We recommend to use the <a href="https://www.lf-lang.org/docs/handbook/intellij">IntelliJ</a> IDE.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Writing tests</h2>
<p>An integral part of contributing code is writing tests.</p>
<p><b>Unit tests</b> for the compiler are located in the <span class="tt"><a class="el" href="namespaceorg_1_1lflang_1_1tests.html">org.lflang.tests</a></span> package (found in the directory <span class="tt">core/src/test/java/org/lflang/tests</span>, in the <span class="tt">core</span> gradle subproject) and are implemented using the JUnit test framework. These tests are invoked using Gradle. For example, to run all the tests in the <span class="tt"><a class="el" href="namespaceorg_1_1lflang_1_1tests_1_1compiler.html">org.lflang.tests.compiler</a></span> package, use the following command:</p>
<div class="fragment"><div class="line">./gradlew :core:test --tests &quot;org.lflang.tests.compiler.*&quot;</div>
</div><!-- fragment --><p><b>Integration tests</b> consist of complete Lingua Franca programs that are located in the <span class="tt">test</span> directory in the root of the repository and are organized first by target, then by category. These tests get indexed automatically and are also invoked using Gradle. For instance, to run all the tests for the C target, use the following command:</p>
<div class="fragment"><div class="line">./gradlew targetTest -Ptarget=C</div>
</div><!-- fragment --><p>For more details, see <a href="https://github.com/lf-lang/lingua-franca/blob/master/test/README.md">test/README.md</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Workflow</h2>
<p>All code contributions must go through a <a href="https://github.com/lf-lang/.github/blob/main/CONTRIBUTING.md#pull-requests">pull request (PR)</a>, pass all tests run in CI, and get an approving review before it is merged. Pushing to the <span class="tt">master</span> branch is restricted. All code review is conducted using the Github review system on PRs. Before requesting a code review, ensure that you have:</p><ul>
<li>applied the [code formatter](code-style-and-formatting);</li>
<li>[documented](code-style-and-formatting) your code;</li>
<li>written [tests](writing-tests) that cover your code; and</li>
<li>accompanied any remaining <span class="tt">TODO</span>s or <span class="tt">FIXME</span>s with a link to an active issue.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Code style and formatting</h2>
<p>The Lingua Franca compiler is implemented in Java and Kotlin. The overarching advice is to use each language's most widely used idioms and conventions, which are fortunately very similar. Documentation for the code should use <a href="https://en.wikipedia.org/wiki/Javadoc">Javadoc</a> comments with <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> formatting for the content. See also <a class="el" href="md__2Users_2runner_2work_2lingua-franca_2lingua-franca_2DOCUMENTATION.html">documentation generation</a>.</p>
<p>The code base is shipped with a <a href="https://github.com/diffplug/spotless">Spotless</a> configuration to check and enforce style compliance. Lingua Franca code (e.g., tests) in this repository is also automatically formatted via Spotless.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Formatting</h3>
<ul>
<li>To check that modified files are formatted correctly, run:</li>
</ul>
<div class="fragment"><div class="line">./gradlew spotlessCheck</div>
</div><!-- fragment --><ul>
<li>To apply the changes recommended by the formatter, run:</li>
</ul>
<div class="fragment"><div class="line">./gradlew spotlessApply</div>
</div><!-- fragment --><p><em>Java code formatting in IntelliJ</em></p>
<p>Follow the directions <a href="https://github.com/ragurney/spotless-intellij-gradle">here</a> to install the Spotless Gradle plugin. We are not currently aware of a way to run Spotless automatically on file save, but it is possible to configure a keybinding.</p>
<p>There is a <a href="https://github.com/google/google-java-format">plugin</a> specifically for enforcing Google's style guide, but we have found difficulty getting it to work properly.</p>
<p><em>Lingua Franca code formatting in VS Code</em></p>
<p>Formatting is provided by the Lingua Franca VS Code extension.</p>
<p>You can enable formatting on save by going to <span class="tt">Settings</span> and searching for "format" and checking the box <span class="tt">Editor: Format on Save</span>. This can be either a user-level or workspace-level setting.</p>
<p><em>Checking using Git hooks</em></p>
<p>If you prefer not to use formatting on save but would still like to avoid committing unformatted code, you can add a file <span class="tt">.git/hooks/pre-commit</span> with the contents:</p>
<div class="fragment"><div class="line">./gradlew spotlessCheck</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
General guidelines</h3>
<ul>
<li><em>Do not copy-paste code.</em> If you want to reuse code, factor it out into a method and call it.</li>
<li><em>Keep methods concise.</em> As a rule of thumb, a method should fit on your screen so that it can be read without scrolling. We impose no hard limit on method length, but anything above 40 lines should be considered for breaking up.</li>
<li><em>Keep classes concise.</em> Classes should be limited in scope and not become too large. Anything above 1000 lines probably needs refactoring.</li>
<li><em>Do not leave FIXMEs</em>. Unaddressed <span class="tt">FIXME</span>s should not be allowed to pass code review unless they are accompanied with a link to a GitHub issue.</li>
</ul>
<p><em>Comments</em></p>
<p>Please adhere to the following principles when writing documentation for your code:</p><ul>
<li>Write descriptions in English.</li>
<li>Do not use contractions like "aren't" or "isn't".</li>
<li>Use imperative in the description of a method, i.e., write "Compute the shortest path," not "Computes the shortest path" (the latter is not a complete sentence).</li>
<li>In <span class="tt">@param</span> JavaDoc tag descriptions it is OK to use incomplete sentences in the interest of brevity.</li>
<li>Use Markdown formatting.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Java-specific guidelines</h3>
<p>We use the <a href="https://google.github.io/styleguide/javaguide.html">Google Java style guide</a>, which leaves a few things unspecified that we discuss here in a bit more depth.</p>
<p><em>Ordering of class contents (<a href="https://google.github.io/styleguide/javaguide.html#s3.4.2-ordering-class-contents">S3.4.2</a>)</em></p>
<blockquote class="doxtable">
<p>The order you choose for the members and initializers of your class can have a great effect on learnability. However, there's no single correct recipe for how to do it; different classes may order their contents in different ways. </p>
</blockquote>
<blockquote class="doxtable">
<p>What is important is that each class uses some logical order, which its maintainer could explain if asked. For example, new methods are not just habitually added to the end of the class, as that would yield "chronological by date added" ordering, which is not a logical ordering. </p>
</blockquote>
<p>When in doubt, the following suggestions might help:</p><ol type="1">
<li>Keep all fields at the very top (and sort them internally by visibility).</li>
<li>After fields, declare constructors.</li>
<li>After constructors, put all methods, in "some logical order".</li>
<li>Put inner classes at the very end.</li>
</ol>
<p><em>Visibility</em></p>
<p>Avoid public non-final fields and public collection fields (making them <span class="tt">final</span> does not make their contents immutable).</p>
<p><em>Inheritance</em></p>
<p>Design for inheritance or prohibit it. Make new classes final by default, and avoid using protected members. The class should only be unsealed if a use case for inheritance shows up, which is in many cases never. Often, composition can offer a better solution than inheritance (also see a <a href="https://matthiasnoback.nl/2018/09/final-classes-by-default-why/">blog post</a> on this).</p>
<p><em>Collections</em></p>
<p>Use interfaces like <span class="tt">List</span>, <span class="tt">Set</span>, <span class="tt">Map</span> to type variables, constructor parameters, and method signatures, not concrete implementations like <span class="tt">LinkedList</span>, <span class="tt">HashSet</span>, or <span class="tt">LinkedHashMap</span>.</p>
<p><em>Collection mutability</em></p>
<p>In Java, instances of collection classes may be read-only. They will throw an exception when modification is attempted. Read-only views on collections are used to prevent external code from modifying an internal collection by accident, which may break class invariants. Encapsulating modifications to the collection into extra mutator methods is good practice, because it allows maintaining class invariants if the class evolves.</p>
<ul>
<li>Assume that any list returned from a method of an object that you do not control is <b>unmodifiable unless otherwise documented</b>. That means, make a copy if you need a local modification.</li>
<li>If you return a collection which is a field of the current object, <b>make it unmodifiable</b> (i.e., <span class="tt">return Collections.unmodifiableList(internalList);</span>). If the API <em>must</em> return a modifiable list, then document that it is modifiable. (It's usually better to provide mutator methods to encapsulate the modification to the collection.)</li>
</ul>
<div class="fragment"><div class="line">/* Assume the returned list is unmodifiable */</div>
<div class="line">List&lt;String&gt; contents = container.getListOfContents();</div>
<div class="line">/* You can iterate on the list, get an item, but not set/add/remove. To make local modifications, make a copy:*/</div>
<div class="line">contents = new ArrayList&lt;&gt;(contents);</div>
<div class="line">/* Now the list is modifiable, but changes do not affect the `container` object */</div>
<div class="line">contents.add(&quot;extra&quot;);</div>
<div class="line"> </div>
<div class="line">/* If you need to modify the internal list of the `container`, add a method to the container that encapsulates that logic */</div>
<div class="line">container.add(&quot;extra&quot;);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Kotlin-specific guidelines</h3>
<p>Please follow the <a href="https://kotlinlang.org/docs/coding-conventions.html">Kotlin coding conventions</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for lingua-franca by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
